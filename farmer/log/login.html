<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="description" content="">
		<meta name="keywords" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
		<title>微信订单管理</title>
		<link rel="stylesheet" href="../../assets/css/amazeui.css">
		<link rel="stylesheet" href="../../assets/css/style.css">
	</head>

	<body style="background: #fff;">
		<header data-am-widget="header" class="am-header am-header-fixed header">
			<div class="am-header-left am-header-nav">
				<a href="javascript:history.back()" class="">
				</a>
			</div>
			<h1 class="am-header-title">
		        <a href="javascript:;" class="title">
		        </a>
		    </h1>
			<div class="am-header-right am-header-nav">
				<a href="register.html">
					<i class="correct">注册</i>
				</a>
			</div>
		</header>
		<div class="log-container">
			<div class="top-img"><img src="../../assets/i/avatar.png" width="70" height="70" /></div>
			<div class="log-number">
				<input type="text" placeholder="请填写手机号" class="txt phone" />
				<span class="del"></span>
				<i class="arrow-down"></i>
				<ul class="number-list">
					<li class="list-item">
						<span class="number">15265256254</span>
						<i class="del-num">x</i>
					</li>
				</ul>
			</div>
			<div class="log-code">
				<input type="password" placeholder="请输入6-15位密码" class="txt code" />
				<span class="del"></span>
			</div>
			<div class="login active">登录</div>
			<div class="other am-cf">
				<div class="left am-fl"><span class="remember"></span>记住密码</div>
				<a href="forget-password.html" class="forget am-fr">忘记密码？</a>
			</div>
		</div>
	</body>
	<script type="text/javascript" src="../../assets/js/jquery.min.js"></script>
	<script type="text/javascript" src="../../assets/js/amazeui.js"></script>
	<script type="text/javascript" src="../../assets/js/common.js"></script>
	<script type="text/javascript" src="../../assets/js/template.js"></script>
	<script>
		$(function() {
			//返回登录页面
			var para = window.location.search;
			if(para != '') {
				var index = para.indexOf('&path');
				var subPara = para.substring(0, index);
				var path = GetQueryString('path') + subPara;
			}
			//点击下拉
			$('.arrow-down').on('click', function() {
				$(this).toggleClass('active');
				var $this = $(this);
				if($this.hasClass('active')) {
					$('.number-list').show();
				} else {
					$('.number-list').hide();
				}
			});
			//焦点进入
			$('.txt').focus(function() {
				$(this).siblings('.del').show();
			});
			//点击删除
			$('.del').on('click', function() {
				$(this).siblings('.txt').val('');
			});
			//点击x号
			$('.del-num').on('click', function() {
				$(this).parent().remove();
			});
			//勾选记住密码
			var count = 0;
			var obj = {};
			var arr = [];
			$('.remember').on('click', function() {
				var phone = $('.phone').val();
				var code = $('.code').val();
				$(this).toggleClass("active");
				if($(this).hasClass('active')) {
					obj.user = phone;
					obj.pwd = code;
					if(count < 5) {
						arr.push(obj);

					}
					console.log(arr)
					setInfo('account', arr);

				} else {

				}
			});
			//点击登录
			$('.login').on('click', function() {
				var username = $('.phone').val();
				var pwd = $('.code').val();
				var reg = /^[a-zA-Z0-9]{6,15}$/;
				if(username == "") {
					mask('请输入手机号');
					return false;
				};
				if(pwd == "") {
					mask('请输入密码');
					return false;
				};
				if(!reg.test(pwd)) {
					mask('你输入的密码格式不正确');
					return false;
				};
				//登录
				$.ajax({
					type: 'POST',
					url: reqUrl("client_login"),
					data: {
						username:username,
						password: pwd,
						utype: 	'client',
						devicetype:2,
						lastloginversion:'1.0.0'
					},
					dataType: 'JSON',
					async: false,
					xhrFields: {
						withCredentials: true
					},
					success: function(data) {
						if(data.success) {
							var token = data.infor[0].token;
							setCookie('token',token,365);
							setCookie('mobile',data.infor[0].mobile,365);
							setInfo('mobileprefix',data.infor[0].mobileprefix);
							setInfo('cid',data.infor[0].id);
							setInfo('nickname',data.infor[0].nickname);
							if(path) {
								window.location.href = preUrl(path);
							} else {
								window.location.href = preUrl('farmer/index/index.html');
							}
							
						} else {
							mask(data.msg);
						}
					},
					error: function(e, request, settings) {
						alert(settings);
					}
				})

			});
		});
	</script>

</html>